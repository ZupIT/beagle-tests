#
# Copyright 2020 ZUP IT SERVICOS EM TECNOLOGIA E INOVACAO SA
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# Action created to avoid the error when we try to update submodules that hava branch property set

name: 'Updating submodules'
description: 'This action updates ths submodules'
inputs:
  token:
    description: 'Github token'
    required: true
runs:
  using: "composite"
  steps:
    - name: disable the keychain credential helper
      run: git config --global credential.helper ""
      shell: bash

    - name: enable the local store credential helper
      run: git config --global --add credential.helper store
      shell: bash

    - name: add credential
      run: echo "https://x-access-token:${{ inputs.token }}@github.com" >> ~/.git-credentials
      shell: bash

    - name: tell git to use https instead of ssh whenever it encounters it
      run: 'git config --global url."https://github.com/".insteadof git@github.com:'
      shell: bash

    - name: Update submodules
      run: git submodule sync & git submodule update --init --recursive --remote
      shell: bash

    - name: Print branch info
      run: git branch
      shell: bash

    - name: Print submodule branch info
      run: git submodule foreach 'git status'
      shell: bash